{
  'target_defaults': {
    'default_configuration': 'Release',
    'configurations': {
      'Debug': {
        'defines': ['DEBUG_ON'],
      },
    }
  },
  'target_defaults': {
    'include_dirs': [
      "<!(node -e \"require('nan')\")",
    ],
    'cflags!': [
        '-fno-exceptions'
    ],
    'cflags': [
      '-fstack-protector-strong',
      '-fPIE -fPIC',
      '-O2 -D_FORTIFY_SOURCE=2',
      '-Wformat -Wformat-security'
    ],
    'cflags_cc!': [
      '-fno-exceptions'
    ],
    'conditions': [
      [
        'OS=="linux"', {
          'defines': [
            'OS_LINUX'
          ],
          'cflags_cc': [
            '-std=c++14'
          ],
          'include_dirs': [
            "<!@(node -e \"console.log(process.env.AMENT_PREFIX_PATH.replace(/:/g, '/include/ ') + '/include/')\")",
          ],
          'library_dirs': [
            "<!@(node -e \"console.log(process.env.AMENT_PREFIX_PATH.replace(/:/g, '/lib/ ') + '/lib/')\")",
          ],
        },
      ],
      [
        'OS=="win"', {
          'defines': [
            'OS_WINDOWS'
          ],
          'cflags_cc': [
            '-std=c++14'
          ],
          'include_dirs': [
            "<!@(node -e \"console.log(process.env.AMENT_PREFIX_PATH.replace(/;/g, '\\\include ').replace(/\\\/g, '/') + '/include')\")",
          ],
          'msvs_settings': {
            'VCCLCompilerTool': {
              'ExceptionHandling': '2', # /EHsc
            },
            'VCLinkerTool': {
              'AdditionalDependencies': ['psapi.lib'],
              'AdditionalLibraryDirectories': ["<!@(node -e \"console.log(process.env.AMENT_PREFIX_PATH.replace(/;/g, '\\\lib ').replace(/\\\/g, '/') + '/lib')\")",],
            }
          }
        },
      ],
      [
        'OS=="mac"', {
          'defines': [
            'OS_MACOS'
          ],
          'include_dirs': [
            "<!@(node -e \"console.log(process.env.AMENT_PREFIX_PATH.replace(/:/g, '/include/ ') + '/include/')\")",
          ],
          'library_dirs': [
              "<!@(node -e \"console.log(process.env.AMENT_PREFIX_PATH.replace(/:/g, '/lib/ ') + '/lib/')\")",
          ],
          'xcode_settings': {
            'GCC_ENABLE_CPP_EXCEPTIONS': 'YES',
            'CLANG_CXX_LIBRARY': 'libc++',
            'MACOS_DEPLOYMENT_TARGET': '10.12',
            'CLANG_CXX_LANGUAGE_STANDARD': 'c++14'
          },
        },
      ],
    ],
  },
  'targets': [
{{~ it.pkgs : pkg}}
    {
      'target_name': '{{=pkg.pkgName}}__rosidl_node',
      'sources': [
        '{{=pkg.pkgName}}/definitions.cpp',
      ],
      'link_settings': {
        'libraries': [
          '-l{{=pkg.pkgName}}__rosidl_generator_c',
        ],
      },
    },
{{~}}
  ],
}
